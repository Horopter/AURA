2025-12-11 03:46:04 [INFO] [lib.utils.memory:89] Memory stats (Stage 5: before training): {'cpu_memory_mb': 751.5078125, 'cpu_memory_gb': 0.7338943481445312, 'cpu_vms_mb': 10440.05078125, 'gpu_allocated_gb': 0.0, 'gpu_reserved_gb': 0.0, 'gpu_total_gb': 16.928342016, 'gpu_free_gb': 16.928342016}
2025-12-11 03:46:04 [DEBUG] [lib.utils.memory:95] CPU percent: 0.0%
2025-12-11 03:46:04 [DEBUG] [lib.utils.memory:96] Num threads: 10
2025-12-11 03:46:04 [INFO] [lib.training.pipeline:169] ================================================================================
2025-12-11 03:46:04 [INFO] [lib.training.pipeline:170] STAGE 5 PREREQUISITE VALIDATION
2025-12-11 03:46:04 [INFO] [lib.training.pipeline:171] ================================================================================
2025-12-11 03:46:04 [INFO] [lib.training.pipeline:174] 
[1/3] Checking Stage 3 (scaled videos) - REQUIRED for all models...
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:183] ✓ Stage 3 metadata found: 3244 scaled videos
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:184]   Path: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/scaled_videos/scaled_metadata.arrow
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:187] 
[2/3] Checking Stage 2 (features) - REQUIRED for *_stage2 models...
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:195] ✓ Stage 2 metadata found: 3244 feature rows
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:196]   Path: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/features_stage2/features_metadata.arrow
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:199] 
[3/3] Checking Stage 4 (scaled features) - REQUIRED for *_stage2_stage4 models...
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:207] ✓ Stage 4 metadata found: 3243 feature rows
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:208]   Path: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/features_stage4/features_scaled_metadata.arrow
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:211] 
================================================================================
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:212] MODEL REQUIREMENTS CHECK
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:213] ================================================================================
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:252] ✓ r2plus1d: CAN RUN
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:255] 
================================================================================
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:256] VALIDATION SUMMARY
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:257] ================================================================================
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:258] Stage 3 (scaled videos): ✓ Available
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:259]   Count: 3244 videos
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:260] Stage 2 (features): ✓ Available
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:261]   Count: 3244 feature rows
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:262] Stage 4 (scaled features): ✓ Available
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:263]   Count: 3243 feature rows
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:264] 
Runnable models: 1/1
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:265]   ['r2plus1d']
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:272] ================================================================================
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:450] 
Stage 5: Loading metadata...
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:476] Loaded metadata: 3244 rows
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:486] ✓ Data validation passed: 3244 rows (> 3000 required)
2025-12-11 03:46:05 [WARNING] [lib.utils.guardrails:171] Disk usage high: free=497796.51GB, used=2002043.49GB (80.1%)
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:508] Stage 5: Found 3244 scaled videos
2025-12-11 03:46:05 [DEBUG] [lib.training.pipeline:538] Successfully imported VideoConfig from lib.models
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:603] 
================================================================================
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:604] Stage 5: Training model: r2plus1d
2025-12-11 03:46:05 [INFO] [lib.training.pipeline:605] ================================================================================
2025-12-11 03:46:10 [INFO] [lib.training.pipeline:642] Using 5-fold stratified cross-validation
2025-12-11 03:46:16 [INFO] [lib.training.pipeline:651] Grid search: 48 hyperparameter combinations to try
2025-12-11 03:46:16 [INFO] [lib.training.pipeline:663] 
================================================================================
2025-12-11 03:46:16 [INFO] [lib.training.pipeline:664] Grid Search: Hyperparameter combination 1/48
2025-12-11 03:46:16 [INFO] [lib.training.pipeline:665] Parameters: {'learning_rate': 1e-05, 'backbone_lr': 1e-06, 'head_lr': 0.0001, 'weight_decay': 0.0001, 'batch_size': 2}
2025-12-11 03:46:16 [INFO] [lib.training.pipeline:666] ================================================================================
2025-12-11 03:46:16 [INFO] [lib.training.pipeline:677] 
Training r2plus1d - Fold 1/5
2025-12-11 03:46:16 [DEBUG] [lib.training.pipeline:713] Successfully imported VideoDataset using direct import
2025-12-11 03:46:16 [ERROR] [__main__:332] ================================================================================
2025-12-11 03:46:16 [ERROR] [__main__:333] STAGE 5 FAILED
2025-12-11 03:46:16 [ERROR] [__main__:334] ================================================================================
2025-12-11 03:46:16 [ERROR] [__main__:335] Error: VideoDataset stub cannot be used. Please ensure lib/models/video.py is properly synced to the server. Expected at: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py
2025-12-11 03:46:16 [ERROR] [__main__:336] Exception type: RuntimeError
2025-12-11 03:46:16 [ERROR] [__main__:337] Full traceback:
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/src/scripts/run_stage5_training.py", line 277, in main
    results = stage5_train_models(
              ^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 778, in stage5_train_models
    train_dataset = VideoDataset(
                    ^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 41, in __init__
    raise RuntimeError(
RuntimeError: VideoDataset stub cannot be used. Please ensure lib/models/video.py is properly synced to the server. Expected at: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py
2025-12-11 03:46:16 [ERROR] [__main__:338] Output directory: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5
2025-12-11 03:46:16 [ERROR] [__main__:339] Partial results may be available
2025-12-11 03:46:16 [ERROR] [__main__:340] ================================================================================
