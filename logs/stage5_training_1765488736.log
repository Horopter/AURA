2025-12-11 16:32:18 [INFO] [lib.utils.memory:89] Memory stats (Stage 5: before training): {'cpu_memory_mb': 772.296875, 'cpu_memory_gb': 0.7541961669921875, 'cpu_vms_mb': 10258.1640625, 'gpu_allocated_gb': 0.0, 'gpu_reserved_gb': 0.0, 'gpu_total_gb': 16.928342016, 'gpu_free_gb': 16.928342016}
2025-12-11 16:32:18 [DEBUG] [lib.utils.memory:95] CPU percent: 0.0%
2025-12-11 16:32:18 [DEBUG] [lib.utils.memory:96] Num threads: 4
2025-12-11 16:32:18 [INFO] [lib.training.stage5_feature_pipeline:63] Loading scaled metadata...
2025-12-11 16:32:19 [INFO] [lib.training.stage5_feature_pipeline:72] Loaded 3244 videos
2025-12-11 16:32:19 [INFO] [lib.training.stage5_feature_pipeline:86] Labels: [0, 1] -> {0: 0, 1: 1}
2025-12-11 16:32:19 [INFO] [lib.training.stage5_feature_pipeline:89] Loading features from Stage 2/4 (collinearity removal will be done once before splits)...
2025-12-11 16:32:19 [INFO] [lib.training.feature_preprocessing:316] Loading Stage 2 features...
2025-12-11 16:32:32 [INFO] [lib.training.feature_preprocessing:363] Loaded 15 Stage 2 features (3244/3244 videos matched)
2025-12-11 16:32:32 [INFO] [lib.training.feature_preprocessing:371] Loading Stage 4 features...
2025-12-11 16:32:48 [DEBUG] [lib.training.feature_preprocessing:411] Sample unmatched Stage 4 videos (showing first 1): ['data/scaled_videos/FX5aeuJFQ64_aug1_scaled_aug1.mp4']
2025-12-11 16:32:48 [DEBUG] [lib.training.feature_preprocessing:412] Sample Stage 4 feature paths (showing first 3): ['data/scaled_videos/51EwLmqOYNg_aug4_scaled_aug4.mp4', 'data/scaled_videos/735177418030252033_aug0_scaled_aug0.mp4', 'data/scaled_videos/-y0Vr7JmCek_aug5_scaled_aug5.mp4']
2025-12-11 16:32:48 [INFO] [lib.training.feature_preprocessing:416] Loaded 23 Stage 4 features (3243/3244 videos matched)
2025-12-11 16:32:48 [INFO] [lib.training.feature_preprocessing:427] Combined 38 features from 2 stages
2025-12-11 16:32:48 [INFO] [lib.training.feature_preprocessing:436] Stage 2: 3244 videos, Stage 4: 3243 videos
2025-12-11 16:32:48 [INFO] [lib.training.feature_preprocessing:437] Intersection (videos with BOTH Stage 2 AND Stage 4): 3243 videos
2025-12-11 16:32:48 [INFO] [lib.training.feature_preprocessing:458] ✓ Found 3243 videos with valid features (>= 3000 required)
2025-12-11 16:32:48 [INFO] [lib.training.feature_training_pipeline:152] Removing collinear features BEFORE data splits (to avoid data leakage)...
2025-12-11 16:32:48 [INFO] [lib.training.feature_training_pipeline:153]   Original feature count: 38
2025-12-11 16:32:49 [INFO] [lib.training.feature_preprocessing:76] Removed 2 features with zero variance
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_noise_mean (correlation=0.992)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_dct_dc_mean (correlation=0.999)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_dct_dc_std (correlation=0.992)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_dct_dc_std (correlation=0.968)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_dct_dc_std (correlation=0.988)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_dct_dc_std (correlation=0.959)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_gradient_std (correlation=0.964)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage2_boundary_inconsistency (correlation=0.994)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage4_noise_energy (correlation=0.958)
2025-12-11 16:32:49 [DEBUG] [lib.training.feature_preprocessing:128] Removing collinear feature: stage4_is_downscaled (correlation=-0.998)
2025-12-11 16:32:49 [INFO] [lib.training.feature_preprocessing:138] Removed 10 collinear features (correlation >= 0.95)
2025-12-11 16:32:49 [INFO] [lib.training.feature_preprocessing:159] Final feature count: 26/38 (68.4% retained)
2025-12-11 16:32:49 [INFO] [lib.training.feature_training_pipeline:162]   Final feature count after collinearity removal: 26/38 (68.4% retained)
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:104] ✓ Loaded 26 features for 3244 videos
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:105]   Features already cleaned (collinearity removed before splits)
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:120] After filtering to videos with valid features: 3243/3244 videos
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:136] ✓ Sufficient videos with valid features: 3243 >= 3000
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:146] Feature-based models: []
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:147] Video-based models: ['slowfast']
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:187] ================================================================================
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:188] TRAINING VIDEO-BASED MODELS
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:189] ================================================================================
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:192] Validating videos and checking for corrupted files...
2025-12-11 16:32:49 [INFO] [lib.training.stage5_feature_pipeline:193] This may take a few minutes...
2025-12-11 16:32:49 [INFO] [lib.utils.video_validation:143] Sampling 324 videos to check validity...
2025-12-11 16:32:49 [INFO] [lib.utils.video_validation:91] Validating 324 videos...
2025-12-11 16:33:01 [INFO] [lib.utils.video_validation:95] Validated 100/324 videos...
2025-12-11 16:33:13 [INFO] [lib.utils.video_validation:95] Validated 200/324 videos...
2025-12-11 16:33:27 [INFO] [lib.utils.video_validation:95] Validated 300/324 videos...
2025-12-11 16:33:30 [INFO] [lib.utils.video_validation:153] Sample validity rate: 100.00% (324/324)
2025-12-11 16:33:30 [INFO] [lib.utils.video_validation:154] Estimated valid videos: 3244/3244
2025-12-11 16:33:30 [INFO] [lib.utils.video_validation:166] Sample suggests sufficient valid videos. Checking all videos to confirm...
2025-12-11 16:33:30 [INFO] [lib.utils.video_validation:91] Validating 3244 videos...
2025-12-11 16:33:41 [INFO] [lib.utils.video_validation:95] Validated 100/3244 videos...
2025-12-11 16:33:50 [INFO] [lib.utils.video_validation:95] Validated 200/3244 videos...
2025-12-11 16:34:01 [INFO] [lib.utils.video_validation:95] Validated 300/3244 videos...
2025-12-11 16:34:12 [INFO] [lib.utils.video_validation:95] Validated 400/3244 videos...
2025-12-11 16:34:23 [INFO] [lib.utils.video_validation:95] Validated 500/3244 videos...
2025-12-11 16:34:38 [INFO] [lib.utils.video_validation:95] Validated 600/3244 videos...
2025-12-11 16:34:50 [INFO] [lib.utils.video_validation:95] Validated 700/3244 videos...
2025-12-11 16:35:02 [INFO] [lib.utils.video_validation:95] Validated 800/3244 videos...
2025-12-11 16:35:14 [INFO] [lib.utils.video_validation:95] Validated 900/3244 videos...
2025-12-11 16:35:27 [INFO] [lib.utils.video_validation:95] Validated 1000/3244 videos...
2025-12-11 16:35:41 [INFO] [lib.utils.video_validation:95] Validated 1100/3244 videos...
2025-12-11 16:35:57 [INFO] [lib.utils.video_validation:95] Validated 1200/3244 videos...
2025-12-11 16:36:15 [INFO] [lib.utils.video_validation:95] Validated 1300/3244 videos...
2025-12-11 16:36:26 [INFO] [lib.utils.video_validation:95] Validated 1400/3244 videos...
2025-12-11 16:36:37 [INFO] [lib.utils.video_validation:95] Validated 1500/3244 videos...
2025-12-11 16:36:49 [INFO] [lib.utils.video_validation:95] Validated 1600/3244 videos...
2025-12-11 16:37:00 [INFO] [lib.utils.video_validation:95] Validated 1700/3244 videos...
2025-12-11 16:37:12 [INFO] [lib.utils.video_validation:95] Validated 1800/3244 videos...
2025-12-11 16:37:23 [INFO] [lib.utils.video_validation:95] Validated 1900/3244 videos...
2025-12-11 16:37:37 [INFO] [lib.utils.video_validation:95] Validated 2000/3244 videos...
2025-12-11 16:37:45 [ERROR] [libav.mov,mp4,m4a,3gp,3g2,mj2:337] moov atom not found
2025-12-11 16:37:51 [INFO] [lib.utils.video_validation:95] Validated 2100/3244 videos...
2025-12-11 16:38:01 [INFO] [lib.utils.video_validation:95] Validated 2200/3244 videos...
2025-12-11 16:38:14 [INFO] [lib.utils.video_validation:95] Validated 2300/3244 videos...
2025-12-11 16:38:27 [INFO] [lib.utils.video_validation:95] Validated 2400/3244 videos...
2025-12-11 16:38:39 [INFO] [lib.utils.video_validation:95] Validated 2500/3244 videos...
2025-12-11 16:38:49 [INFO] [lib.utils.video_validation:95] Validated 2600/3244 videos...
2025-12-11 16:39:02 [INFO] [lib.utils.video_validation:95] Validated 2700/3244 videos...
2025-12-11 16:39:15 [INFO] [lib.utils.video_validation:95] Validated 2800/3244 videos...
2025-12-11 16:39:25 [INFO] [lib.utils.video_validation:95] Validated 2900/3244 videos...
2025-12-11 16:39:36 [INFO] [lib.utils.video_validation:95] Validated 3000/3244 videos...
2025-12-11 16:39:48 [INFO] [lib.utils.video_validation:95] Validated 3100/3244 videos...
2025-12-11 16:39:59 [INFO] [lib.utils.video_validation:95] Validated 3200/3244 videos...
2025-12-11 16:40:08 [INFO] [lib.utils.video_validation:181] Video validation complete:
2025-12-11 16:40:08 [INFO] [lib.utils.video_validation:182]   Total videos: 3244
2025-12-11 16:40:08 [INFO] [lib.utils.video_validation:183]   Valid videos: 3243
2025-12-11 16:40:08 [INFO] [lib.utils.video_validation:184]   Invalid videos: 1
2025-12-11 16:40:08 [INFO] [lib.utils.video_validation:185]   Corrupted videos: 1
2025-12-11 16:40:08 [INFO] [lib.utils.video_validation:202] ✓ Sufficient valid videos: 3243 >= 3000
2025-12-11 16:40:08 [INFO] [lib.training.stage5_feature_pipeline:206] ✓ Video validation complete: 3243 valid videos
2025-12-11 16:40:08 [INFO] [lib.training.stage5_feature_pipeline:216] Invalid videos report saved to: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5/invalid_videos_report.txt
2025-12-11 16:40:08 [INFO] [lib.training.stage5_feature_pipeline:227] After video validation: 3243 valid videos
2025-12-11 16:40:09 [INFO] [lib.training.stage5_feature_pipeline:250] Train: 1945, Val: 649, Test: 649
2025-12-11 16:40:09 [INFO] [lib.training.stage5_feature_pipeline:253] ================================================================================
2025-12-11 16:40:09 [INFO] [lib.training.stage5_feature_pipeline:254] Training slowfast (video-based)
2025-12-11 16:40:09 [INFO] [lib.training.stage5_feature_pipeline:255] ================================================================================
2025-12-11 16:40:09 [INFO] [lib.training.video_training_pipeline:117] Using GPU for slowfast
2025-12-11 16:40:09 [INFO] [lib.training.video_training_pipeline:122] Training slowfast with scaled videos: sampling 1000 frames per video (uniformly across video duration)
2025-12-11 16:40:09 [INFO] [lib.training.video_training_pipeline:152] Memory config: batch_size=32, gradient_accumulation=32, num_workers=0
2025-12-11 16:40:09 [INFO] [lib.training.video_training_pipeline:153] Effective batch size: 1024
2025-12-11 16:40:09 [INFO] [lib.utils.memory:89] Memory stats (before hyperparameter search): {'cpu_memory_mb': 795.20703125, 'cpu_memory_gb': 0.7765693664550781, 'cpu_vms_mb': 10381.0625, 'gpu_allocated_gb': 0.0, 'gpu_reserved_gb': 0.0, 'gpu_total_gb': 16.928342016, 'gpu_free_gb': 16.928342016}
2025-12-11 16:40:09 [DEBUG] [lib.utils.memory:95] CPU percent: 0.0%
2025-12-11 16:40:09 [DEBUG] [lib.utils.memory:96] Num threads: 6
2025-12-11 16:40:09 [INFO] [lib.training.video_training_pipeline:160] Hyperparameter search: 48 combinations
2025-12-11 16:40:09 [INFO] [lib.training.video_training_pipeline:172] Grid search 1/48: {'backbone_lr': 1e-06, 'batch_size': 2, 'head_lr': 0.0001, 'learning_rate': 1e-05, 'weight_decay': 0.0001}
2025-12-11 16:40:11 [INFO] [lib.utils.memory:89] Memory stats (grid_search_0): {'cpu_memory_mb': 925.97265625, 'cpu_memory_gb': 0.9042701721191406, 'cpu_vms_mb': 10863.55078125, 'gpu_allocated_gb': 0.0, 'gpu_reserved_gb': 0.0, 'gpu_total_gb': 16.928342016, 'gpu_free_gb': 16.928342016}
2025-12-11 16:40:11 [WARNING] [lib.training.slowfast:64] torchvision SlowFast not available. Using r3d_18 as pretrained backbone.
2025-12-11 16:40:19 [ERROR] [lib.training.stage5_feature_pipeline:279] ✗ Failed to train slowfast: Image.rotate() got an unexpected keyword argument 'fill'
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/stage5_feature_pipeline.py", line 261, in stage5_train_all_models
    results = train_video_model(
              ^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/video_training_pipeline.py", line 237, in train_video_model
    for batch_idx, (batch_videos, batch_labels) in enumerate(train_loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 522, in __getitem__
    frame_tensor = self._frame_transform(frame)  # (C, H, W)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torchvision/transforms/transforms.py", line 95, in __call__
    img = t(img)
          ^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/augmentation/transforms.py", line 37, in __call__
    return img.rotate(
           ^^^^^^^^^^^
TypeError: Image.rotate() got an unexpected keyword argument 'fill'
2025-12-11 16:40:19 [INFO] [lib.training.stage5_feature_pipeline:282] ================================================================================
2025-12-11 16:40:19 [INFO] [lib.training.stage5_feature_pipeline:283] STAGE 5 TRAINING COMPLETE
2025-12-11 16:40:19 [INFO] [lib.training.stage5_feature_pipeline:284] ================================================================================
2025-12-11 16:40:19 [INFO] [lib.training.stage5_feature_pipeline:290] Successful: 0/1
2025-12-11 16:40:19 [INFO] [lib.training.stage5_feature_pipeline:291] Failed: 1/1
2025-12-11 16:40:19 [WARNING] [lib.training.stage5_feature_pipeline:303] Failed models:
2025-12-11 16:40:19 [WARNING] [lib.training.stage5_feature_pipeline:305]   slowfast: Image.rotate() got an unexpected keyword argument 'fill'
2025-12-11 16:40:19 [INFO] [lib.utils.memory:89] Memory stats (Stage 5: after training): {'cpu_memory_mb': 1291.8671875, 'cpu_memory_gb': 1.2615890502929688, 'cpu_vms_mb': 11418.25390625, 'gpu_allocated_gb': 0.0, 'gpu_reserved_gb': 0.148897792, 'gpu_total_gb': 16.928342016, 'gpu_free_gb': 16.779444224}
2025-12-11 16:40:19 [DEBUG] [lib.utils.memory:95] CPU percent: 0.0%
2025-12-11 16:40:19 [DEBUG] [lib.utils.memory:96] Num threads: 7
