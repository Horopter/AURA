2025-12-13 04:13:54 [INFO] [__main__:310] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:311] STAGE 5: MODEL TRAINING
2025-12-13 04:13:54 [INFO] [__main__:312] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:313] Project root: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc
2025-12-13 04:13:54 [INFO] [__main__:314] Scaled metadata: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/scaled_videos/scaled_metadata.arrow
2025-12-13 04:13:54 [INFO] [__main__:315] Features Stage 2: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/features_stage2/features_metadata.arrow
2025-12-13 04:13:54 [INFO] [__main__:316] Features Stage 4: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/features_stage4/features_scaled_metadata.arrow
2025-12-13 04:13:54 [INFO] [__main__:317] Model types: ['xgboost_r2plus1d']
2025-12-13 04:13:54 [INFO] [__main__:318] K-fold splits: 5
2025-12-13 04:13:54 [INFO] [__main__:319] Number of frames: 1000
2025-12-13 04:13:54 [INFO] [__main__:320] Output directory: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5
2025-12-13 04:13:54 [INFO] [__main__:321] Experiment tracking: Enabled
2025-12-13 04:13:54 [INFO] [__main__:324] Delete existing: True
2025-12-13 04:13:54 [INFO] [__main__:325] Resume mode: True
2025-12-13 04:13:54 [INFO] [__main__:326] Log file: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/logs/stage5_training_1765617234.log
2025-12-13 04:13:54 [INFO] [__main__:333] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:334] Checking prerequisites...
2025-12-13 04:13:54 [INFO] [__main__:335] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:342] ✓ Scaled metadata file found: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/scaled_videos/scaled_metadata.arrow
2025-12-13 04:13:54 [INFO] [__main__:352] ✓ All model types are valid
2025-12-13 04:13:54 [INFO] [__main__:358] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:359] Initial memory statistics:
2025-12-13 04:13:54 [INFO] [__main__:360] ================================================================================
2025-12-13 04:13:54 [INFO] [lib.utils.memory:91] Memory stats (Stage 5: before training): {'cpu_memory_mb': 735.68359375, 'cpu_memory_gb': 0.7184410095214844, 'cpu_vms_mb': 10217.640625, 'gpu_allocated_gb': 0.0, 'gpu_reserved_gb': 0.0, 'gpu_total_gb': 16.928342016, 'gpu_free_gb': 16.928342016}
2025-12-13 04:13:54 [INFO] [__main__:364] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:365] Starting Stage 5: Model Training
2025-12-13 04:13:54 [INFO] [__main__:366] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:367] Training 1 model(s) with 5-fold cross-validation
2025-12-13 04:13:54 [INFO] [__main__:368] This may take a while depending on dataset size and model complexity...
2025-12-13 04:13:54 [INFO] [__main__:369] Progress will be logged in real-time
2025-12-13 04:13:54 [INFO] [__main__:370] ================================================================================
2025-12-13 04:13:54 [INFO] [__main__:375] Calling Stage 5 training pipeline...
2025-12-13 04:13:54 [INFO] [__main__:376] This may take a while - progress will be logged in real-time
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:497] ================================================================================
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:498] Stage 5: Model Training Pipeline Started
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:499] ================================================================================
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:500] Model types: ['xgboost_r2plus1d']
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:501] K-fold splits: 5
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:502] Frames per video: 1000
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:503] Output directory: data/stage5
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:504] Initializing pipeline...
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:266] ================================================================================
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:267] STAGE 5 PREREQUISITE VALIDATION
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:268] ================================================================================
2025-12-13 04:13:54 [INFO] [lib.training.pipeline:271] 
[1/3] Checking Stage 3 (scaled videos) - REQUIRED for all models...
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:280] ✓ Stage 3 metadata found: 3278 scaled videos
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:281]   Path: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/scaled_videos/scaled_metadata.arrow
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:284] 
[2/3] Checking Stage 2 (features) - REQUIRED for *_stage2 models...
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:292] ✓ Stage 2 metadata found: 3278 feature rows
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:293]   Path: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/features_stage2/features_metadata.arrow
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:296] 
[3/3] Checking Stage 4 (scaled features) - REQUIRED for *_stage2_stage4 models...
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:304] ✓ Stage 4 metadata found: 3277 feature rows
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:305]   Path: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/features_stage4/features_scaled_metadata.arrow
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:308] 
================================================================================
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:309] MODEL REQUIREMENTS CHECK
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:310] ================================================================================
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:334] ✓ xgboost_r2plus1d: CAN RUN
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:337] 
================================================================================
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:338] VALIDATION SUMMARY
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:339] ================================================================================
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:340] Stage 3 (scaled videos): ✓ Available
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:341]   Count: 3278 videos
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:342] Stage 2 (features): ✓ Available
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:343]   Count: 3278 feature rows
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:344] Stage 4 (scaled features): ✓ Available
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:345]   Count: 3277 feature rows
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:346] 
Runnable models: 1/1
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:347]   ['xgboost_r2plus1d']
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:354] ================================================================================
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:590] 
Stage 5: Loading metadata...
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:616] Loaded metadata: 3278 rows
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:626] ✓ Data validation passed: 3278 rows (> 3000 required)
2025-12-13 04:13:55 [WARNING] [lib.utils.guardrails:171] Disk usage high: free=828322.04GB, used=1671517.96GB (66.9%)
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:648] Loading Stage 2 and Stage 4 features (required for feature-based models)...
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:658] Stage 5: Found 3278 scaled videos
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:732] Frame caching enabled (default): cache_dir=data/.frame_cache. This will cache processed frames to disk to speed up training. First epoch will be slower (building cache), subsequent epochs will be faster. To disable, set FVC_USE_FRAME_CACHE=0
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:798] Overriding num_frames to 250 for xgboost_r2plus1d (XGBoost pretrained model) to prevent OOM. Original num_frames was 1000.
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:832] Stage 5: Deleting existing model results (clean mode)...
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:841] Deleted existing results for xgboost_r2plus1d
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:844] Stage 5: Deleted 1 existing model directories
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:849] 
================================================================================
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:850] Stage 5: Training model: xgboost_r2plus1d
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:851] ================================================================================
2025-12-13 04:13:55 [INFO] [lib.training.pipeline:870] Overriding model_config num_frames to 250 for xgboost_r2plus1d (XGBoost pretrained model) to prevent OOM during feature extraction.
2025-12-13 04:13:56 [INFO] [lib.training.pipeline:890] Grid search: 1 hyperparameter combinations to try
2025-12-13 04:13:56 [INFO] [lib.training.pipeline:904] ================================================================================
2025-12-13 04:13:56 [INFO] [lib.training.pipeline:905] HYPERPARAMETER SEARCH: Using 10.0% stratified sample for efficiency
2025-12-13 04:13:56 [INFO] [lib.training.pipeline:906] ================================================================================
2025-12-13 04:13:57 [INFO] [lib.training.pipeline:916] Hyperparameter search sample: 327 rows (10.0% of 3278 total)
2025-12-13 04:13:57 [INFO] [lib.training.pipeline:917] To change sample size, set FVC_GRID_SEARCH_SAMPLE_SIZE environment variable (current: 0.1)
2025-12-13 04:13:58 [INFO] [lib.training.pipeline:930] Using 5-fold stratified cross-validation on 10.0% sample for hyperparameter search
2025-12-13 04:13:58 [INFO] [lib.training.pipeline:943] 
================================================================================
2025-12-13 04:13:58 [INFO] [lib.training.pipeline:944] Grid Search: Hyperparameter combination 1/1
2025-12-13 04:13:58 [INFO] [lib.training.pipeline:945] Parameters: {'n_estimators': 100, 'max_depth': 5, 'learning_rate': 0.1, 'subsample': 0.8, 'colsample_bytree': 0.8}
2025-12-13 04:13:58 [INFO] [lib.training.pipeline:946] ================================================================================
2025-12-13 04:13:58 [INFO] [lib.training.pipeline:975] 
Hyperparameter Search - xgboost_r2plus1d - Fold 1/5 (10.0% sample)
2025-12-13 04:13:58 [INFO] [lib.training.pipeline:1561] Training XGBoost model xgboost_r2plus1d on fold 1...
2025-12-13 04:13:58 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:13:58 [INFO] [lib.training._xgboost_pretrained:477] Processing 261 videos...
2025-12-13 04:13:58 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:13:59 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:00 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:00 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:00 [ERROR] [lib.training.pipeline:1629] Error training XGBoost fold 1: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 1576, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:01 [INFO] [lib.training.pipeline:975] 
Hyperparameter Search - xgboost_r2plus1d - Fold 2/5 (10.0% sample)
2025-12-13 04:14:01 [INFO] [lib.training.pipeline:1561] Training XGBoost model xgboost_r2plus1d on fold 2...
2025-12-13 04:14:01 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:01 [INFO] [lib.training._xgboost_pretrained:477] Processing 261 videos...
2025-12-13 04:14:01 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:01 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:02 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:02 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:02 [ERROR] [lib.training.pipeline:1629] Error training XGBoost fold 2: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 1576, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:02 [INFO] [lib.training.pipeline:975] 
Hyperparameter Search - xgboost_r2plus1d - Fold 3/5 (10.0% sample)
2025-12-13 04:14:02 [INFO] [lib.training.pipeline:1561] Training XGBoost model xgboost_r2plus1d on fold 3...
2025-12-13 04:14:02 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:02 [INFO] [lib.training._xgboost_pretrained:477] Processing 262 videos...
2025-12-13 04:14:02 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:03 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:03 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:03 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:03 [ERROR] [lib.training.pipeline:1629] Error training XGBoost fold 3: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 1576, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:04 [INFO] [lib.training.pipeline:975] 
Hyperparameter Search - xgboost_r2plus1d - Fold 4/5 (10.0% sample)
2025-12-13 04:14:04 [INFO] [lib.training.pipeline:1561] Training XGBoost model xgboost_r2plus1d on fold 4...
2025-12-13 04:14:04 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:04 [INFO] [lib.training._xgboost_pretrained:477] Processing 262 videos...
2025-12-13 04:14:04 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:04 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:05 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:05 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:05 [ERROR] [lib.training.pipeline:1629] Error training XGBoost fold 4: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 1576, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:05 [INFO] [lib.training.pipeline:975] 
Hyperparameter Search - xgboost_r2plus1d - Fold 5/5 (10.0% sample)
2025-12-13 04:14:05 [INFO] [lib.training.pipeline:1561] Training XGBoost model xgboost_r2plus1d on fold 5...
2025-12-13 04:14:05 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:05 [INFO] [lib.training._xgboost_pretrained:477] Processing 262 videos...
2025-12-13 04:14:06 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:06 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:06 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:07 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:07 [ERROR] [lib.training.pipeline:1629] Error training XGBoost fold 5: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 1576, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1883] Parameter combination 1 - Mean F1: nan, Mean Acc: nan
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1895] Using single parameter combination: {'n_estimators': 100, 'max_depth': 5, 'learning_rate': 0.1, 'subsample': 0.8, 'colsample_bytree': 0.8}
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1898] ================================================================================
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1899] FINAL TRAINING: Using full dataset with best hyperparameters
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1900] ================================================================================
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1913] Final training: Using 5-fold stratified cross-validation on full dataset (3278 rows)
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1921] Final training using best hyperparameters: {'n_estimators': 100, 'max_depth': 5, 'learning_rate': 0.1, 'subsample': 0.8, 'colsample_bytree': 0.8}
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1927] 
Final Training - xgboost_r2plus1d - Fold 1/5 (full dataset)
2025-12-13 04:14:07 [INFO] [lib.training.pipeline:1936] Deleted existing final training fold 1 directory (clean mode)
2025-12-13 04:14:07 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:07 [INFO] [lib.training._xgboost_pretrained:477] Processing 2621 videos...
2025-12-13 04:14:07 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:08 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:08 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:08 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:08 [ERROR] [lib.training.pipeline:2301] Error training final fold 1: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 2180, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:08 [INFO] [lib.training.pipeline:1927] 
Final Training - xgboost_r2plus1d - Fold 2/5 (full dataset)
2025-12-13 04:14:08 [INFO] [lib.training.pipeline:1936] Deleted existing final training fold 2 directory (clean mode)
2025-12-13 04:14:08 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:08 [INFO] [lib.training._xgboost_pretrained:477] Processing 2622 videos...
2025-12-13 04:14:08 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:09 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:09 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:09 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:09 [ERROR] [lib.training.pipeline:2301] Error training final fold 2: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 2180, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:09 [INFO] [lib.training.pipeline:1927] 
Final Training - xgboost_r2plus1d - Fold 3/5 (full dataset)
2025-12-13 04:14:09 [INFO] [lib.training.pipeline:1936] Deleted existing final training fold 3 directory (clean mode)
2025-12-13 04:14:09 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:09 [INFO] [lib.training._xgboost_pretrained:477] Processing 2623 videos...
2025-12-13 04:14:10 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:10 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:10 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:11 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:11 [ERROR] [lib.training.pipeline:2301] Error training final fold 3: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 2180, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:11 [INFO] [lib.training.pipeline:1927] 
Final Training - xgboost_r2plus1d - Fold 4/5 (full dataset)
2025-12-13 04:14:11 [INFO] [lib.training.pipeline:1936] Deleted existing final training fold 4 directory (clean mode)
2025-12-13 04:14:11 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:11 [INFO] [lib.training._xgboost_pretrained:477] Processing 2623 videos...
2025-12-13 04:14:11 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:11 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:12 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:12 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:12 [ERROR] [lib.training.pipeline:2301] Error training final fold 4: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 2180, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:12 [INFO] [lib.training.pipeline:1927] 
Final Training - xgboost_r2plus1d - Fold 5/5 (full dataset)
2025-12-13 04:14:12 [INFO] [lib.training.pipeline:1936] Deleted existing final training fold 5 directory (clean mode)
2025-12-13 04:14:12 [INFO] [lib.training._xgboost_pretrained:476] Training XGBoost on features from r2plus1d...
2025-12-13 04:14:12 [INFO] [lib.training._xgboost_pretrained:477] Processing 2623 videos...
2025-12-13 04:14:12 [INFO] [lib.training._xgboost_pretrained:381] Loading pretrained model: r2plus1d (num_frames=250)
2025-12-13 04:14:12 [INFO] [lib.training._xgboost_pretrained:396] Loaded r2plus1d model to GPU, cleared cache
2025-12-13 04:14:13 [INFO] [lib.training._xgboost_pretrained:444] Extracting features using r2plus1d (num_frames=250)...
2025-12-13 04:14:13 [INFO] [lib.training._xgboost_pretrained:84] Applied PyTorch memory optimizations for feature extraction
2025-12-13 04:14:13 [ERROR] [lib.training.pipeline:2301] Error training final fold 5: name 'Path' is not defined
Traceback (most recent call last):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/pipeline.py", line 2180, in stage5_train_models
    model.fit(train_df, project_root=project_root_str_orig)
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 486, in fit
    features, y = self._extract_features_batch(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 445, in _extract_features_batch
    features = extract_features_from_pretrained_model(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/training/_xgboost_pretrained.py", line 97, in extract_features_from_pretrained_model
    for batch_idx, (clips, _) in enumerate(loader):
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 732, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 788, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/venv/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 775, in __getitem__
    video_path = self._get_video_path(row)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/lib/models/video.py", line 624, in _get_video_path
    project_root_path = Path(self.project_root).resolve()
                        ^^^^
NameError: name 'Path' is not defined
2025-12-13 04:14:13 [WARNING] [lib.training.pipeline:119] No model files found in /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5/xgboost_r2plus1d/fold_1 to copy
2025-12-13 04:14:13 [INFO] [lib.training.pipeline:2374] 
xgboost_r2plus1d - Avg Val Loss: nan, Avg Val Acc: nan, Avg Val F1: nan
2025-12-13 04:14:15 [INFO] [lib.training.visualization:256] Saved CV fold comparison to /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5/xgboost_r2plus1d/plots/cv_fold_comparison.png
2025-12-13 04:14:15 [INFO] [lib.training.pipeline:2402] Generated plots for xgboost_r2plus1d in /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5/xgboost_r2plus1d/plots
2025-12-13 04:14:15 [INFO] [lib.training.pipeline:2439] ================================================================================
2025-12-13 04:14:15 [INFO] [lib.training.pipeline:2440] Stage 5: Model Training Pipeline Completed
2025-12-13 04:14:15 [INFO] [lib.training.pipeline:2441] ================================================================================
2025-12-13 04:14:15 [INFO] [__main__:401] ================================================================================
2025-12-13 04:14:15 [INFO] [__main__:402] STAGE 5 COMPLETED SUCCESSFULLY
2025-12-13 04:14:15 [INFO] [__main__:403] ================================================================================
2025-12-13 04:14:15 [INFO] [__main__:404] Execution time: 20.88 seconds (0.35 minutes)
2025-12-13 04:14:15 [INFO] [__main__:406] Output directory: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5
2025-12-13 04:14:15 [INFO] [__main__:407] Models trained: ['xgboost_r2plus1d']
2025-12-13 04:14:15 [INFO] [__main__:408] K-fold splits: 5
2025-12-13 04:14:15 [INFO] [__main__:414] ================================================================================
2025-12-13 04:14:15 [INFO] [__main__:415] Final memory statistics:
2025-12-13 04:14:15 [INFO] [__main__:416] ================================================================================
2025-12-13 04:14:15 [INFO] [lib.utils.memory:91] Memory stats (Stage 5: after training): {'cpu_memory_mb': 1070.3984375, 'cpu_memory_gb': 1.0453109741210938, 'cpu_vms_mb': 47393.1875, 'gpu_allocated_gb': 0.0, 'gpu_reserved_gb': 0.262144, 'gpu_total_gb': 16.928342016, 'gpu_free_gb': 16.666198016}
2025-12-13 04:14:15 [INFO] [__main__:419] ================================================================================
2025-12-13 04:14:15 [INFO] [__main__:420] Training complete!
2025-12-13 04:14:15 [INFO] [__main__:421] Results saved to: /gpfs/accounts/si670f25_class_root/si670f25_class/santoshd/fvc/data/stage5
2025-12-13 04:14:15 [INFO] [__main__:422] ================================================================================
